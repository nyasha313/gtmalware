package com.malware.server.maps;

import org.json.JSONException;
import org.json.JSONObject;

import com.malware.server.utils.UrlReader;

import uk.me.jstott.jcoord.LatLng;

public class GoogleMaps {

	public static String DIRECTIONS_SERVICE_URL = "http://maps.google.com/maps/nav";
	
	public static double getDrivingDistance(LatLng start, LatLng end) {
		String url = generateUrlForDirectionsBetween(start, end);
		
		String urlContent = UrlReader.getContentfromURL(url);  
		
		JSONObject json = null;
		try {
			json = new JSONObject(urlContent);
		} catch (JSONException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		double distance = -1;
		try {
			distance = json.getJSONObject("Directions").getJSONObject("Distance")
					   .getDouble("meters");
		} catch (JSONException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return distance;
	}
	
	/**
	 * Generate a URL to query Google for directions between start and end points.
	 */
	private static String generateUrlForDirectionsBetween(LatLng start, LatLng end) {
		String url = DIRECTIONS_SERVICE_URL;
		url += "?";
		url += "q=";
		url += "from:" + removeParenthesisAndSpaces(start.toString());
		url += "+to:" + removeParenthesisAndSpaces(end.toString());
		return url;
	}
	
	
	/**
	 * Removes occurrences of all opening and closing parenthesis
	 * and all spaces from the input string.
	 */
	private static String removeParenthesisAndSpaces(String input) {
		input = input.replace("(", "");
		input = input.replace(")", "");
		input = input.replace(" ", "");
		return input;
	}
}
