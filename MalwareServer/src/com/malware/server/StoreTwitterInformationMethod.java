package com.malware.server;

import com.malware.common.dto.ServerRequest;
import com.malware.common.dto.ServerResponse;
import com.malware.common.dto.User;
import com.malware.common.dto.ServerRequest.ServerMethod;
import com.malware.common.dto.ServerResponse.ResponseCode;
import com.malware.common.dto.User.SocialNetworkInformation;

public class StoreTwitterInformationMethod {

	public static ServerResponse execute(ServerRequest serverRequest) {
		assert serverRequest.getServerMethod() == ServerMethod.STORE_TWITTER_INFORMATION;
		
		ServerResponse serverResponse = new ServerResponse();
		
		// Get the email out of the serverRequest.
		String email = serverRequest.getUser().getEmail();
		SocialNetworkInformation twitterInformation = serverRequest.getUser().getTwitterInformation();
		
		// Check if the user is there in the database in the first place.
		if (!CommonDataAccessMethods.doesEmailExist(email)) {
			serverResponse.setResponseCode(ResponseCode.FAILURE);
			serverResponse.setReponseMessage("Email id is not found in the database.");
			return serverResponse;
		}
		
		// Get the user information from the datastore.
		User user = CommonDataAccessMethods.getUser(email);
		
		// Add the twitter information in.
		user.setTwitterInformation(twitterInformation);
		
		// Store it back into the database.
		CommonDataAccessMethods.storeUser(user);
		
		serverResponse.setResponseCode(ResponseCode.SUCCESS);
		return serverResponse;
	}
}
