package com.malware.server;

import java.util.ArrayList;
import java.util.List;

import javax.jdo.PersistenceManager;

import com.google.appengine.repackaged.com.google.common.base.Pair;
import com.malware.common.dto.Trip;

/**
 * Performs the route calculation.
 */
public class RouteCalculator {

	@SuppressWarnings("unchecked")
	public static List<Trip> getBestTripsForADriver(Trip driverTrip) {
		PersistenceManager pm = PMF.get().getPersistenceManager();

		// TODO(kaushikr): Make a query with searchKeyword.
		String query = "select from " + Trip.class.getName();
		
		/* GeoHash used to overcome limitation of GQL */
		//Geohash geohash = new Geohash();
		
		/* List of strings consisting of geohash of all points along the route */
		List<Pair<Integer, Integer>> driverGeoPoints = new ArrayList<Pair<Integer,Integer>>();
		//List<String> geoPointsAsHash = new ArrayList<String>();
		
		/*Source address*/
		//geoPointsAsHash.add( geohash.encode(riderTrip.getSourceLat(),riderTrip.getSourceLng()) );
		driverGeoPoints.add(new Pair<Integer, Integer>(driverTrip.getSourceLat(), 
				driverTrip.getSourceLng()));
		
		/*Via Points*/
		
		List<Integer> viaPointsLat = driverTrip.getViaPointsLat();
		List<Integer> viaPointsLng = driverTrip.getViaPointsLng();
		for(int i = 0; i< viaPointsLat.size(); ++i) {
			//geoPointsAsHash.add( geohash.encode(viaPointsLat.get(i), viaPointsLng.get(i)) );
			driverGeoPoints.add(new Pair<Integer, Integer>(viaPointsLat.get(i), viaPointsLng.get(i)));
		}
		
		/* Destination address */
		//geoPointsAsHash.add( geohash.encode(riderTrip.getDestinationLat(), riderTrip.getDestinationLng()) );
		driverGeoPoints.add(new Pair<Integer, Integer>(driverTrip.getDestinationLat(), 
				driverTrip.getDestinationLng()));
		
		List<Trip> trips = (List<Trip>) pm.newQuery(query).execute();
		//trips = pm.getObjectById(Trip.class);
		
		return trips;
	}
	
	@SuppressWarnings("unchecked")
	public static List<Trip> getBestTripsForARider(Trip riderTrip) {
		PersistenceManager pm = PMF.get().getPersistenceManager();

		// TODO(kaushikr): Make a query with searchKeyword.
		String query = "select from " + Trip.class.getName();
		List<Trip> trips = (List<Trip>) pm.newQuery(query).execute();

		return trips;	
	}
}
