package com.malware.server.maps;

import javax.jdo.annotations.IdGeneratorStrategy;
import javax.jdo.annotations.PersistenceCapable;
import javax.jdo.annotations.Persistent;
import javax.jdo.annotations.PrimaryKey;

import org.json.JSONException;
import org.json.JSONObject;

import com.google.appengine.api.datastore.Key;
import com.google.appengine.api.datastore.Text;

/**
 * Represents a Route that the Google Maps API returns.
 * 
 * Simply wraps all of the JSON data into an easily accessible class.
 * 
 * @author Kaushik
 */
@PersistenceCapable
public class Route {
    @PrimaryKey
    @Persistent(valueStrategy = IdGeneratorStrategy.IDENTITY)
    private Key key;
    
	private JSONObject json = null;
	
	@Persistent
	private Text jsonText = null;
    
	public Route(String jsonStringRepresentation) {
		try {
			json = new JSONObject(jsonStringRepresentation);
		} catch (JSONException e) {
			json = null;
		}
	}

	public Route(JSONObject json) {
		this.json = json;
	}
	
	public JSONObject getJson() {
		return json;
	}
	
	/**
	 * Returns the distance of this route in metres.
	 */
	public double getDistanceInMetres() {
		try {
			return getDistance().getDouble("meters");
		} catch (JSONException e) {
			return -1;
		}
	}
	
	private JSONObject getDistance() {
		try {
			return getDirections().getJSONObject("Distance");
		} catch (JSONException e) {
			return null;
		}
	}
	
	private JSONObject getDirections() {
		try {
			return json.getJSONObject("Directions");
		} catch (JSONException e) {
			return null;
		}
	}
	
	/**
	 * Makes this object persistable to be stored with a PersistenceManager.
	 * 
	 * This method *MUST* be called before this object is stored.
	 */
	public void makePersistable() {
		jsonText = new Text(json.toString());
	}
}
