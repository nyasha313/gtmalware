package com.malware.server;

import com.malware.common.dto.ServerRequest;
import com.malware.common.dto.ServerResponse;
import com.malware.common.dto.User;
import com.malware.common.dto.ServerRequest.ServerMethod;
import com.malware.common.dto.ServerResponse.ResponseCode;

public class VerifyUserMethod {
	
	public static ServerResponse execute(ServerRequest serverRequest) {
		assert serverRequest.getServerMethod() == ServerMethod.VERIFY_USER;
		
		ServerResponse serverResponse = new ServerResponse();
		
		// Get the email out of the serverRequest.
		String email = serverRequest.getUser().getEmail();
		String password = serverRequest.getUser().getPassword();
		boolean success = false;
		
		// Check if the user is there in the database in the first place.
		if (!CommonDataAccessMethods.doesEmailExist(email)) {
			success = false;
		} else {
			// Get the user information from the datastore.
			User user = CommonDataAccessMethods.getUser(email);
			
			if (user.getPassword().equals(password)) {
				success = true;
			} else {
				success = false;
			}
		}
		
		if (success) {
			serverResponse.setResponseCode(ResponseCode.SUCCESS);
			return serverResponse;			
		} else {
			serverResponse.setResponseCode(ResponseCode.FAILURE);
			serverResponse.setReponseMessage("Wrong email id or password.");
			return serverResponse;
		}
	}
}
