package com.malware.server;

import java.util.List;

import com.malware.common.dto.ServerRequest;
import com.malware.common.dto.ServerResponse;
import com.malware.common.dto.Trip;
import com.malware.common.dto.ServerRequest.ServerMethod;
import com.malware.common.dto.ServerResponse.ResponseCode;

/**
 * This class stores information about a new user into the database.
 */
public class SearchRidersTripsMethod {

	public static ServerResponse execute(ServerRequest serverRequest) {
		assert serverRequest.getServerMethod() == ServerMethod.SEARCH_RIDERS_TRIPS;
		
		String email = serverRequest.getUser().getEmail();
		
		List<Trip> trips = CommonDataAccessMethods.searchRidersTrips(email);
		
		for (int i = 0; i < trips.size(); ++i) {
			Trip trip = CommonDataAccessMethods.getTrip(trips.get(i).getId());
			if (trip.isAssigned() == true && trip.isAssignedNotified() == false) {
				trip.setAssignedNotified(true);
				CommonDataAccessMethods.storeTrip(trip);
			}
		}
		
		ServerResponse serverResponse = new ServerResponse();
		serverResponse.setResponseCode(ResponseCode.SUCCESS);
		
		serverResponse.setTrips(trips);
		
		return serverResponse;
	}
}
